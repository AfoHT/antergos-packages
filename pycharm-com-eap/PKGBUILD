# Maintainer: Dustin Falgout <dustin@falgout.us>
# Contributor: Gifts <gifts.antichat@gmail.com>
# Contributor: Andrey Vlasovskikh <andrey.vlasovskikh@gmail.com>


pkgname=pycharm-com-eap
_buildver=143.595
_pkgver=5.0.1
_eap="False"
pkgver="${_pkgver}.${_buildver}"
pkgrel=1
pkgdesc="Powerful Python and Django IDE, Early Access Program (EAP) build. Community edition."
arch=(any)
options=('!strip')
url="http://www.jetbrains.com/pycharm/"
license=("custom")
makedepends=("wget")
depends=("java-environment>=6")
provides=("pycharm-eap" "pycharm-community")
conflicts=("pycharm-eap" "pycharm-community" "pycharm-professional")

if [[ "True" = "${_eap}" ]]; then
	_srcfile="pycharm-community-${_buildver}.tar.gz"
	source=("http://download.jetbrains.com/python/${_srcfile}")
	sha256sums=$(wget -q "${source}.sha256" && cat "${_srcfile}.sha256" | cut -f1 -d" ")
else
	_srcfile="pycharm-community-${_pkgver}.tar.gz"
	source=("http://download.jetbrains.com/python/${_srcfile}")
	sha256sums=$(wget -q "${source}.sha256" && cat "${_srcfile}.sha256" | cut -f1 -d" ")
fi

package() {
  	cd "${srcdir}"
	install -dm 755 \
		"${pkgdir}/opt/${pkgname}" \
		"${pkgdir}/usr/bin/" \
		"${pkgdir}/usr/share/applications/"

	if [[ "True" = "${_eap}" ]]; then
		cp -R "${srcdir}/pycharm-community-${_buildver}/"* "${pkgdir}/opt/${pkgname}"
	else
		cp -R "${srcdir}/pycharm-community-${_pkgver}/"* "${pkgdir}/opt/${pkgname}"
	fi
	
	if [[ "i686" = "${CARCH}" ]]; then
		rm -f "${pkgdir}/opt/${pkgname}/bin/libyjpagent-linux64.so"
		rm -f "${pkgdir}/opt/${pkgname}/bin/fsnotifier64"
	fi

	sed -i "s/Version=/Version=${pkgver}/g" "${pkgname}.desktop"
	install -Dm644 "${srcdir}/${pkgname}.desktop" "${pkgdir}/usr/share/applications/"

	ln -s "/opt/${pkgname}/bin/pycharm.sh" "${pkgdir}/usr/bin/pycharm-eap"
}

# -*- mode: bash;-*-
