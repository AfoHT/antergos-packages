# Maintainer: Antergos Developers <dev@antergos.com>
# Contributor: isiachi <isiachi@rhyeworld.it>

pkgname=spl
pkgver=0.7.1
pkgrel=1
pkgdesc="Solaris Porting Layer kernel modules."
license=('GPL')
makedepends=("git")
depends=("dkms" "spl-utils=${pkgver}" "linux-headers")
provides=("spl-dkms")
conflicts=("spl-dkms")
install=spl.install
arch=("x86_64")
url="http://zfsonlinux.org/"
_commit=''
_tag='spl-0.7.1'
source=("https://github.com/zfsonlinux/spl/archive/${_tag}.zip")
md5sums=('f893c5cad2c04df5712c808afffa780a')
install=spl.install

build() {
	cd "${srcdir}/${pkgname}-${_tag}"
	./autogen.sh
	./configure \
		--prefix=/usr \
		--libdir=/usr/lib \
		--sbindir=/usr/bin \
		--with-config=user
	make
}

package() {
	dkmsdir="${pkgdir}/usr/src/spl-${pkgver}"
	install -d "${dkmsdir}"

	cp -a "${srcdir}/${pkgname}-${_tag}"/. ${dkmsdir}

	cd "${dkmsdir}"
	./autogen.sh
	scripts/dkms.mkconf -v ${pkgver} -f dkms.conf -n spl
	chmod g-w,o-w -R .
}
